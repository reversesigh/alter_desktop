#!/bin/bash

# ALTER_desktop-0.0.5-alpha - An Unofficial Desktop App for Linux-x64 wrapped with 'nativefier'

## resources/scrollbar.css injection script from https://gist.github.com/febritecno/82ec55602ccd2cbb08ef69fa4c863d46/

## Loading Vairables    
     echo
     source resources/variables
     echo
     echo
     
     echo "Detecting Operating System..."
if [[ "$OSTYPE" =~ ^darwin ]]; then
     echo "Not supported on macOS"
     exit
fi

if [[ "$OSTYPE" =~ ^linux-gnu ]]; then
     echo "Linux detected - continuing install"
fi

if [[ "$OSTYPE" =~ ^windows ]]; then
     echo "Not supported on Windows"
     exit
fi

     
## Intro
     echo
     echo  
     echo -e "${BOLDGREEN}$TX0${ENDCOLOR}"
     echo
     echo
     $DV2
     echo
     echo -e "${RED}$VERSION${ENDCOLOR}"
     echo
     $DV2


## Checks for Nativefier via npm. If not found then uses npm to install Nativefier.
     echo
     echo -e "${BOLDGREEN}$SM1${ENDCOLOR}"
     echo
     
if ! $RD2 nativefier >/dev/null; then

     echo -e "${CYAN}$TX1${ENDCOLOR}" "${BOLDRED}$TX2${ENDCOLOR}"
     echo
     echo -e "${BOLDGREEN}$TX3${ENDCOLOR}"
     $COMM1 "$@"
   else
     echo -e "${BOLDGREEN}$TX4${ENDCOLOR}"
     

fi

     echo
     $DV2
     echo

## Creates ALTER.desktop to local applications folder, allowing it to be discoverable in your applications list
     echo
if ! $IT0 >/dev/null; then
     echo No .desktop file detected. Creating...
   else
     $RM $HOME/.local/share/applications/ALTER.desktop
     echo Removed old .desktop file and created new .desktop file.
fi   
     echo -e "${BOLDGREEN}$SM2${ENDCOLOR}"
     
cat <<EOF >> ~/.local/share/applications/ALTER.desktop
[Desktop Entry]
Encoding=UTF-8
Version=1.0
Type=Application
Terminal=false
Exec=$HOME/.local/share/ALTER_desktop/ALTER_desktop
Name=ALTER
Icon=$HOME/.local/share/icons/alter.png
EOF

     echo
     cat $HOME/.local/share/applications/ALTER.desktop

## Copies alter.png to your root icons folder to use the ALTER logo as the ALTER_dekstop icon
     $DV2
     echo
     echo -e "${BOLDGREEN}$SM4${ENDCOLOR}"
     $CP resources/alter.png $HOME/.local/share/icons/
     echo
     $DV2

## Creates wrapped web application using nativefier
     echo
     echo
     echo -e "${BOLDGREEN}$TX0${ENDCOLOR}"
     echo
     echo
     nativefier --version
     node resources/nativefier.js
     echo
     echo
     $DV2

## Move ALTER-linux-x64 to ALTER_desktop
     echo
     echo -e "${BOLDGREEN}$SM5${ENDCOLOR}"
     $MV ALTER_desktop-linux-x64 ALTER_desktop
     echo

## Copying ALTER_desktop to $HOME/.local/ALTER_desktop
     $EP6
     $CP -r ALTER_desktop $HOME/.local/share/
     $RM -rf ALTER_desktop
     echo



## Checks to make sure installing ALTER_desktop was a success
if $IT9 2>/dev/null; then
     echo WARNING ALTER_desktop not on system
     echo -e "${CYAN}$SM7${ENDCOLOR}"
     exit
     $DV2
   else
     echo
     echo
     echo
     echo
     echo -e "${GREY}$SM8${ENDCOLOR}"
     echo
fi

     $DV2
     echo
     echo -e "${YELLOW}$MSG1${ENDCOLOR}"
     echo
     echo -e "${YELLOW}$MSG2${ENDCOLOR}" "${GREY}$EMAIL1${ENDCOLOR}" or "${GREY}$EMAIL2${ENDCOLOR}"
     echo
     echo -e "${YELLOW}$MSG3${ENDCOLOR}" "${GREY}$ALTER${ENDCOLOR}"
     echo
     echo -e "${GREY}$URLS${ENDCOLOR}"
     echo
     echo
     echo -e "${BOLDRED}$DIVIDER${ENDCOLOR}"
